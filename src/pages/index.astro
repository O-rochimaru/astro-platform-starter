---
import Layout from '../layouts/Layout.astro'; // If using a layout
---

<Layout>
  <main>
    <h1>Welcome!</h1>
    <div id="visitor-info">Loading...</div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        function getVisitorInfo() {
          fetch('https://api.ipify.org?format=json')
            .then(response => response.json())
            .then(data => {
              const ipAddress = data.ip;
              if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                  (position) => {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    fetch(`https://geocode.maps.co/reverse?lat=${latitude}&lon=${longitude}`)
                      .then(response => response.json())
                      .then(locationData => {
                        let locationString = "Location: ";
                        if (locationData.display_name) {
                          locationString += locationData.display_name;
                        } else {
                          locationString += `Latitude: ${latitude}, Longitude: ${longitude}`;
                        }
                        document.getElementById('visitor-info').textContent = `IP: ${ipAddress}, ${locationString}`;
                      })
                      .catch(error => {
                        document.getElementById('visitor-info').textContent = `IP: ${ipAddress}, Location: Could not determine location. Error: ${error.message}`;
                      });
                  },
                  (error) => {
                    document.getElementById('visitor-info').textContent = `IP: ${ipAddress}, Location: Could not determine location. Error: ${error.message}`;
                  },
                  { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
                );
              } else {
                document.getElementById('visitor-info').textContent = "IP Address: " + ipAddress + "\nGeolocation is not supported by this browser.";
              }
            })
            .catch(error => {
              document.getElementById('visitor-info').textContent = "Could not get IP address. Error: " + error;
            });
        }

        getVisitorInfo();
      });
    </script>
  </main>
</Layout>
